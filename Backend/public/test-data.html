<!DOCTYPE html>
<html>
<head>
    <title>üß™ Data Test - Humanity Platform</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .card { 
            border: 1px solid #ddd; 
            margin: 15px 0; 
            padding: 20px; 
            border-radius: 8px; 
            background: #fafafa;
        }
        .stats { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 30px; 
        }
        .error { color: #e74c3c; font-weight: bold; }
        .success { color: #27ae60; font-weight: bold; }
        .warning { color: #f39c12; font-weight: bold; }
        .refresh-btn { 
            background: #3498db; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px 5px;
        }
        .refresh-btn:hover { background: #2980b9; }
        .timestamp { font-size: 12px; color: #666; }
        h1 { color: #2c3e50; text-align: center; }
        h2 { color: #34495e; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Humanity Platform - Data Test</h1>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="refresh-btn" onclick="testData()">üîÑ Refresh Data</button>
            <button class="refresh-btn" onclick="window.open('http://localhost:3000', '_blank')">üåê Open React App</button>
            <button class="refresh-btn" onclick="window.open('http://localhost:5000', '_blank')">üîß Open Backend</button>
        </div>
        
        <div class="stats">
            <h2>üìä Dashboard Statistics</h2>
            <div id="stats">Loading...</div>
            <div class="timestamp" id="stats-time"></div>
        </div>
        
        <div>
            <h2>üìã Story Cards Data</h2>
            <div id="posts">Loading...</div>
            <div class="timestamp" id="posts-time"></div>
        </div>
        
        <div>
            <h2>‚úÖ Expected vs Actual</h2>
            <div id="validation">Checking...</div>
        </div>
    </div>
    
    <script>
        async function testData() {
            const now = new Date().toLocaleString();
            
            try {
                console.log('üß™ Testing data at', now);
                
                // Test stats API
                console.log('üìä Fetching stats...');
                const statsResponse = await fetch('/api/stats');
                const stats = await statsResponse.json();
                console.log('Stats received:', stats);
                
                document.getElementById('stats').innerHTML = `
                    <div class="success">‚úÖ Stats API Connected</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <h3>üí∞ Total Donations</h3>
                            <div style="font-size: 2em; font-weight: bold;">‚Çπ${stats.totalDonations}</div>
                        </div>
                        <div style="text-align: center;">
                            <h3>üìñ Stories Shared</h3>
                            <div style="font-size: 2em; font-weight: bold;">${stats.totalPosts}</div>
                        </div>
                        <div style="text-align: center;">
                            <h3>ü§ù Collaborations</h3>
                            <div style="font-size: 2em; font-weight: bold;">${stats.totalCollaborations}</div>
                        </div>
                    </div>
                `;
                document.getElementById('stats-time').textContent = `Last updated: ${now}`;
                
                // Test posts API
                console.log('üìã Fetching posts...');
                const postsResponse = await fetch('/api/posts');
                const posts = await postsResponse.json();
                console.log('Posts received:', posts);
                
                let postsHtml = '<div class="success">‚úÖ Posts API Connected</div>';
                posts.forEach((post, index) => {
                    postsHtml += `
                        <div class="card">
                            <h3>${post.title}</h3>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 15px 0;">
                                <div>
                                    <strong>üí∞ Amount Raised:</strong><br>
                                    <span style="font-size: 1.5em; color: #27ae60;">‚Çπ${(post.donationAmount || 0).toLocaleString()}</span>
                                </div>
                                <div>
                                    <strong>üë• Number of Donors:</strong><br>
                                    <span style="font-size: 1.5em; color: #3498db;">${post.donations || 0}</span>
                                </div>
                            </div>
                            <p><strong>üìç Location:</strong> ${post.location}</p>
                            <p><strong>üìß Contact:</strong> ${post.contactInfo}</p>
                            <p><strong>üö® Urgency:</strong> ${post.urgencyLevel}</p>
                            <p><strong>üìÖ Status:</strong> ${post.status}</p>
                            <div style="font-size: 12px; color: #666; margin-top: 10px;">
                                Raw data: donationAmount=${post.donationAmount}, donations=${post.donations}
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('posts').innerHTML = postsHtml;
                document.getElementById('posts-time').textContent = `Last updated: ${now}`;
                
                // Validation
                let validationHtml = '';
                
                // Check Ravi's data
                const raviPost = posts.find(p => p.title.includes('Ravi'));
                if (raviPost) {
                    if (raviPost.donationAmount === 400 && raviPost.donations === 4) {
                        validationHtml += '<div class="success">üéâ Ravi\'s Card: CORRECT (‚Çπ400 from 4 donors)</div>';
                    } else {
                        validationHtml += `<div class="error">‚ùå Ravi's Card: INCORRECT (‚Çπ${raviPost.donationAmount} from ${raviPost.donations} donors, expected ‚Çπ400 from 4 donors)</div>`;
                    }
                } else {
                    validationHtml += '<div class="error">‚ùå Ravi\'s post not found</div>';
                }
                
                // Check dashboard stats
                if (stats.totalDonations === 100 && stats.totalPosts === 1 && stats.totalCollaborations === 1) {
                    validationHtml += '<div class="success">üéâ Dashboard Stats: CORRECT (‚Çπ100 total, 1 story, 1 collaboration)</div>';
                } else {
                    validationHtml += `<div class="error">‚ùå Dashboard Stats: INCORRECT (‚Çπ${stats.totalDonations} total, ${stats.totalPosts} stories, ${stats.totalCollaborations} collaborations)</div>`;
                }
                
                // Check other posts
                const otherPosts = posts.filter(p => !p.title.includes('Ravi'));
                const allOthersZero = otherPosts.every(p => (p.donationAmount || 0) === 0 && (p.donations || 0) === 0);
                if (allOthersZero) {
                    validationHtml += '<div class="success">üéâ Other Cards: CORRECT (‚Çπ0 from 0 donors)</div>';
                } else {
                    validationHtml += '<div class="error">‚ùå Other Cards: Some have non-zero donations</div>';
                }
                
                document.getElementById('validation').innerHTML = validationHtml;
                
            } catch (error) {
                console.error('‚ùå Error testing data:', error);
                document.getElementById('stats').innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
                document.getElementById('posts').innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
                document.getElementById('validation').innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        // Test data on page load
        testData();
        
        // Auto-refresh every 10 seconds
        setInterval(testData, 10000);
    </script>
</body>
</html>